# Cheated off of https://github.com/beetbox/beets/blob/master/.travis.yml
dist: xenial
os: linux
language: python

jobs:
  include:
    - language: python
      python: 3.7
      env: {TOX_ENV: py37-type}
      install:
        - travis_retry pip install tox
        - travis_retry tox -e $TOX_ENV $SITE_PACKAGES --notest
      script:
        - tox -e $TOX_ENV $SITE_PACKAGES

    - language: python
      python: 3.7
      env: {TOX_ENV: py37-test}
      install:
        - travis_retry pip install tox
        - travis_retry tox -e $TOX_ENV $SITE_PACKAGES --notest
      script:
        - tox -e $TOX_ENV $SITE_PACKAGES

    - language: python
      python: 3.7
      env: {TOX_ENV: py37-cover}
      before_install:
        - travis_retry pip install codecov
      after_success:
        - codecov
      install:
        - travis_retry pip install tox
        - travis_retry tox -e $TOX_ENV $SITE_PACKAGES --notest
      script:
        - tox -e $TOX_ENV $SITE_PACKAGES

    # https://medium.com/faun/configuring-travis-ci-for-angular-application-34afee1715f
    - language: node_js   # https://stackoverflow.com/questions/27644586/
      node_js: 14
      env:
        - PATH=/opt/python/3.7.1/bin:$PATH
      cache:
        directories:
          - ./ui/node_modules
      before_install:
        - python3 -V
        - python3 -m pip install -r requirements.txt
        - python3 shapeflow.py --server &disown && sleep 1 && curl http://localhost:7951/api/ping && sleep 1 && curl -X POST http://localhost:7951/api/quit && sleep 1 # check whether shapeflow.py runs properly on TravisCI
      install:
        - cd ui && npm install
      script:
        - npm run test
